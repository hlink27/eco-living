<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Acompanhamento de Servi√ßos</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:opsz,wght@6..12,400;6..12,500;6..12,600;6..12,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/buttons.css">
  </head>
  <body>
    <% for(u of unidade){ %>
      <div class="wrapper">
        <div class="card">
      <header class="main-header">
        <div class="brand">
          <div class="imagem-ficha">
            <img src="<%= u.img %>" alt="" class="logo">
          </div>
          <div class="unity-title">
            <div class="espacamento"></div>
            <h1 class="name"><%= u.nome %></h1>
            <div class="espacamento">
              <a href="/add-tema/<%= u.id %>" class="add-tema">Add</a>
            </div>
          </div>
        </div>
      </header>
      <main class="main-content">
        <div class="scrolling-container">
          <% for(t of tema){ %>
            <% var subs = [] %>
            <section id="idv">
              <div style="display: flex; justify-content: space-between; flex-flow: row nowrap;">
                <div class="section-title"><%= t.nome %></div>
                <div class="add-subtema"><a href="/add-subtema/<%= t.id %>">Add</a></div>
              </div>
              
              <% for(s of subtema){
                if(s.tema_id == t.id){
                  subs.push(s)
                }
              } %>
              <% if(t.progresso != 0){ %>
                <%
                  var total = subs.length
                  if(total > 0){
                    var corte = 0
                    for(s of subs){
                      if(s.sts == 'pronto'){
                        corte++
                      }
                    }
                    var porcentagem = (100 * corte) / total
                  } else {
                    var porcentagem = 0
                  }
                %>
                <div class="progress">
                  <div class="progress-bar" role="progressbar" style="width: <%= porcentagem %>%" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
              <% } %>
              <ul class="items-list">
                <% for(s of subs){ console.log(s)%>
                  <li>
                    <span class="item-name"><%= s.nome %></span>
                    <div class="status <%= s.sts %>"><%= s.sts %></div>
                  </li>
                <% } %>
              </ul>
            </section>
          <% } %>
        </div>
      </main>
    </div>
    </div>
    <% } %>
    <script src="" async defer></script>
  </body>
</html>